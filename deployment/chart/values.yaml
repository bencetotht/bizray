# Default values for bizray
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  namespace: bnb
  imagePullSecrets:
    - name: regcred-bnb
  labels:
    env.skip: cloud

# Service Account configuration
serviceAccount:
  create: true
  name: bizray-svc-a
  labels:
    env.skip: cloud

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 1

  image:
    repository: europe-west3-docker.pkg.dev/bnbdevelopment/bizray/bizray-frontend
    tag: "1.0.39"
    pullPolicy: Always

  service:
    name: bizray-frontend-svc
    type: ClusterIP
    port: 80
    targetPort: 80
    portName: frontend-open

  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  env:
    - name: NODE_ENV
      value: "production"

  securityContext:
    allowPrivilegeEscalation: false

  podLabels:
    app: bizray-frontend
    pod-security.kubernetes.io/audit: baseline

  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1

# Backend configuration
backend:
  enabled: true
  replicaCount: 1

  image:
    repository: europe-west3-docker.pkg.dev/bnbdevelopment/bizray/bizray-backend
    tag: "1.0.46"
    pullPolicy: Always

  service:
    name: bizray-backend-svc
    type: ClusterIP
    port: 3000
    targetPort: 3000
    portName: backend-open

  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  env:
    - name: NODE_ENV
      value: "production"
    - name: DATABASE_URL
      value: "postgresql+psycopg://admin:admin@192.168.88.46:5432/bizray"
    - name: REDIS_HOST
      value: "192.168.88.46"

  # Secret references for sensitive data
  secrets:
    - name: JWT_SECRET
      secretName: bizray-creds
      key: JWT_SECRET
    - name: API_KEY
      secretName: bizray-creds
      key: API_KEY
    - name: WSDL_URL
      secretName: bizray-creds
      key: WSDL_URL
    - name: REDIS_PASSWORD
      secretName: bizray-creds
      key: REDIS_PASSWORD

  securityContext:
    allowPrivilegeEscalation: false

  podLabels:
    app: bizray-backend
    pod-security.kubernetes.io/audit: baseline

  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1

# Traefik IngressRoute configuration
ingressRoute:
  enabled: true
  name: bizray-ingressroute
  annotations:
    kubernetes.io/ingress.class: traefik-external
  labels:
    env.skip: cloud
  entryPoints:
    - web
    - websecure
  routes:
    - match: "Host(`chart.example.com`) && PathPrefix(`/`)"
      kind: Rule
      priority: 10
      serviceName: bizray-frontend-svc
      servicePort: 80
    - match: "Host(`api.example.com`) && PathPrefix(`/`)"
      kind: Rule
      serviceName: bizray-backend-svc
      servicePort: 3000

# Prometheus ServiceMonitor configuration
serviceMonitor:
  enabled: true
  name: bizray-backend
  namespace: monitoring
  labels:
    release: prom
    prometheus: system-monitoring-prometheus
    env.skip: cloud
  selector:
    matchLabels:
      app: bizray-backend
  namespaceSelector:
    matchNames:
      - bnb
  endpoints:
    - port: backend-open
      path: /metrics
      interval: 30s
